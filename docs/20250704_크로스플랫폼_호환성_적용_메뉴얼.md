# 20250704_크로스플랫폼_호환성_적용_메뉴얼

## 개요

이 메뉴얼은 LawPass 사건 파일 관리 시스템의 모든 Python 스크립트에 크로스 플랫폼 호환성을 적용하는 방법을 제시합니다. 시스템이 Windows와 WSL(Windows Subsystem for Linux) 환경에서 모두 원활하게 작동하도록 하는 것이 목표입니다.

### 배경
- 기존 코드는 Windows 환경에서 개발되어 하드코딩된 Windows 경로를 사용
- WSL 환경에서 실행 시 경로 문제로 인한 오류 발생
- 개발자가 두 환경을 모두 사용할 수 있도록 자동 감지 기능 필요

### 해결 방안
- 플랫폼 자동 감지 함수 구현
- 런타임 시 적절한 경로 자동 선택
- 기존 Windows 경로를 주석으로 보존하여 호환성 유지

## 핵심 패턴: 플랫폼 자동 감지 함수

### 1. 기본 함수 템플릿

```python
import os
import platform

def is_wsl():
    """WSL 환경인지 감지"""
    try:
        with open('/proc/version', 'r') as f:
            version_info = f.read()
            return 'Microsoft' in version_info or 'WSL' in version_info
    except:
        return False

def get_platform_paths():
    """플랫폼별 경로 자동 감지"""
    if platform.system() == "Windows":
        # Windows 환경
        vault_path = r"D:\GoogleDriveLaptop\LifewithAI-20250120"
        backup_path = r"D:\전자소송다운로드_백업"
        credentials_path = r"C:\Users\lawpass\.config\pdf2text\credentials.json"
        poppler_path = r"C:\Users\lawpass\scoop\apps\poppler\current\bin"
    elif is_wsl():
        # WSL 환경
        vault_path = "/mnt/d/GoogleDriveLaptop/LifewithAI-20250120"
        backup_path = "/mnt/d/전자소송다운로드_백업"
        credentials_path = "/mnt/c/Users/lawpass/.config/pdf2text/credentials.json"
        poppler_path = None  # 시스템 패키지 사용
    else:
        # Linux/macOS 환경
        vault_path = "/mnt/d/GoogleDriveLaptop/LifewithAI-20250120"
        backup_path = "/mnt/d/전자소송다운로드_백업"
        credentials_path = "/mnt/c/Users/lawpass/.config/pdf2text/credentials.json"
        poppler_path = None  # 시스템 패키지 사용
    
    return vault_path, backup_path, credentials_path, poppler_path

def get_environment_type():
    """환경 타입 반환"""
    if platform.system() == "Windows":
        return "windows"
    elif is_wsl():
        return "wsl"
    else:
        return "linux"
```

### 2. 환경변수 기반 접근법

```python
import os
from dotenv import load_dotenv

def get_config_with_env():
    """환경변수와 자동 감지 조합"""
    load_dotenv()
    
    # 환경변수 우선
    vault_path = os.getenv('VAULT_PATH')
    if not vault_path:
        # 자동 감지 fallback
        vault_path, _, _, _ = get_platform_paths()
    
    return vault_path
```

## 수정 대상 파일 분석

### 1. 우선순위 높음 (즉시 수정 필요)

#### `config.yaml`
- **문제**: 하드코딩된 Windows 경로
- **수정 필요 항목**:
  - `general.source_folder`: `"D:\\전자소송다운로드"`
  - `general.backup_folder`: `"D:\\전자소송다운로드_백업"`
  - `text_extraction.poppler_path`: `"C:\\Users\\lawpass\\scoop\\apps\\poppler\\current\\bin"`
  - `text_extraction.google_credentials_path`: `"C:\\Users\\lawpass\\.config\\pdf2text\\credentials.json"`

#### `steps/step0_casefiles_downloadfolder_manager.py`
- **문제**: 하드코딩된 경로
- **수정 필요 항목**:
  - `source_folder = r"D:\\전자소송다운로드"` (라인 6)
  - `backup_base_folder = r"D:\\전자소송다운로드_백업"` (라인 7)

#### `steps/step1_copy_case_path.py`
- **문제**: VAULT_PATH 하드코딩
- **수정 필요 항목**:
  - `VAULT_PATH = r"D:\googleDrive\LifewithAI-20250120"` (라인 6)

#### `tools/pack_legal_cases_auto.py`
- **문제**: 여러 하드코딩된 경로
- **수정 필요 항목**:
  - `VAULT_PATH = r"D:\\GoogleDriveStreaming\\내 드라이브\\LifewithAI-20250120"` (라인 15)
  - `OUTPUT_PATH = r"D:\\GoogleDriveStreaming\\내 드라이브\\LifewithAI-20250120\\Legalcases_repomix"` (라인 16)

### 2. 우선순위 중간 (검토 후 수정)

#### `backup/pack_legal_cases_auto.py`
- **설명**: 백업 파일이지만 동일한 문제 존재
- **조치**: 메인 파일 수정 후 동일하게 적용

#### `.env`
- **설명**: 이미 수정 완료 (플랫폼별 경로 추가됨)
- **조치**: 다른 스크립트에서 환경변수 활용 방법 추가

## 단계별 적용 방법

### Step 1: 기본 함수 추가
각 Python 파일에 플랫폼 감지 함수들을 추가합니다.

```python
# 파일 상단에 추가
import platform

def is_wsl():
    """WSL 환경인지 감지"""
    try:
        with open('/proc/version', 'r') as f:
            version_info = f.read()
            return 'Microsoft' in version_info or 'WSL' in version_info
    except:
        return False

def get_platform_paths():
    """플랫폼별 경로 자동 감지"""
    # 각 파일에 맞는 경로 설정
    if platform.system() == "Windows":
        # Windows 환경 경로
        pass
    elif is_wsl():
        # WSL 환경 경로
        pass
    else:
        # Linux 환경 경로
        pass
    
    return 경로들...
```

### Step 2: 기존 하드코딩된 경로 수정
```python
# 기존 코드 (수정 전)
VAULT_PATH = r"D:\GoogleDriveLaptop\LifewithAI-20250120"

# 수정 후 코드
# 설정 - 플랫폼별 경로 (자동 감지)
# Windows: VAULT_PATH = r"D:\GoogleDriveLaptop\LifewithAI-20250120"
# WSL/Linux: VAULT_PATH = "/mnt/d/GoogleDriveLaptop/LifewithAI-20250120"
VAULT_PATH = get_platform_paths()[0]

print(f"감지된 환경: {get_environment_type()}")
print(f"사용할 경로: {VAULT_PATH}")
```

### Step 3: 환경별 로직 분기
```python
# 기존 코드 (수정 전)
if platform.system() == "Windows":
    # Windows 전용 로직
    pass

# 수정 후 코드
env_type = get_environment_type()
if env_type == "windows":
    # Windows 전용 로직
    pass
elif env_type == "wsl":
    # WSL 전용 로직
    pass
else:
    # Linux 전용 로직
    pass
```

### Step 4: config.yaml 수정 방법
YAML 파일은 코드로 직접 수정할 수 없으므로, 런타임에 경로를 치환하거나 환경변수를 활용합니다.

```python
import yaml
import os

def load_config_with_platform_paths():
    """플랫폼별 경로가 적용된 설정 로드"""
    with open('config.yaml', 'r', encoding='utf-8') as file:
        config = yaml.safe_load(file)
    
    # 플랫폼별 경로 적용
    vault_path, backup_path, credentials_path, poppler_path = get_platform_paths()
    
    config['general']['source_folder'] = backup_path.replace('_백업', '')
    config['general']['backup_folder'] = backup_path
    config['text_extraction']['poppler_path'] = poppler_path
    config['text_extraction']['google_credentials_path'] = credentials_path
    
    return config
```

## 테스트 방법

### 1. WSL 환경에서 테스트
```bash
# WSL 터미널에서 실행
cd /mnt/d/GoogleDriveLaptop/LifewithAI-20250120/Scripts/lawpass_casefiles_management_system_v1
python3 스크립트명.py
```

### 2. Windows 환경에서 테스트
```cmd
# Windows 명령 프롬프트에서 실행
cd D:\GoogleDriveLaptop\LifewithAI-20250120\Scripts\lawpass_casefiles_management_system_v1
python 스크립트명.py
```

### 3. 환경 감지 확인
각 스크립트 실행 시 다음과 같은 출력을 확인합니다:
```
감지된 환경: wsl (또는 windows)
사용할 경로: /mnt/d/GoogleDriveLaptop/LifewithAI-20250120 (또는 D:\GoogleDriveLaptop\LifewithAI-20250120)
```

## 체크리스트

### 파일별 수정 완료 체크리스트

- [ ] `config.yaml` - 런타임 경로 치환 로직 추가
- [ ] `steps/step0_casefiles_downloadfolder_manager.py` - 플랫폼 감지 함수 추가 및 경로 수정
- [ ] `steps/step1_copy_case_path.py` - VAULT_PATH 자동 감지 적용
- [ ] `steps/step2_create_standard_folders.py` - 경로 관련 부분 검토
- [ ] `steps/step3_casefiles_importer.py` - 경로 관련 부분 검토
- [ ] `steps/step4_casefiles_renamer.py` - 경로 관련 부분 검토
- [ ] `steps/step5_casefiles_extractor.py` - 경로 관련 부분 검토
- [ ] `tools/pack_legal_cases_auto.py` - 다중 경로 자동 감지 적용
- [ ] `tools/casefiles_extractor_by_input.py` - 경로 관련 부분 검토
- [ ] `tools/add_folder_prefix.py` - 경로 관련 부분 검토
- [ ] `tools/folder_packager.py` - 경로 관련 부분 검토
- [ ] `tools/md_to_txt_converter.py` - 경로 관련 부분 검토
- [ ] `backup/pack_legal_cases_auto.py` - 백업 파일 동일하게 수정
- [x] `tools/pack_legal_case_interactive.py` - 이미 수정 완료
- [x] `.env` - 이미 수정 완료 (플랫폼별 환경변수 추가)

### 기능 테스트 체크리스트

- [ ] WSL 환경에서 메인 스크립트 실행 테스트
- [ ] Windows 환경에서 메인 스크립트 실행 테스트
- [ ] 파일 경로 접근 테스트 (폴더 존재 여부 확인)
- [ ] 환경 감지 함수 정확성 테스트
- [ ] 각 스텝별 실행 테스트
- [ ] 도구 스크립트들 실행 테스트
- [ ] 오류 로그 확인 및 문제 해결

## 일반적인 문제 해결

### 1. 경로 접근 권한 문제
```bash
# WSL에서 Windows 파일에 접근할 때 권한 문제
sudo chmod -R 755 /mnt/d/GoogleDriveLaptop/
```

### 2. 한글 경로 문제
```python
# 한글 경로 처리 시 인코딩 문제
import locale
locale.setlocale(locale.LC_ALL, 'ko_KR.UTF-8')
```

### 3. 환경변수 로드 문제
```python
# .env 파일 로드 실패 시
from dotenv import load_dotenv
load_dotenv(override=True)
```

### 4. WSL 환경 감지 실패
```python
# 대체 WSL 감지 방법
def is_wsl_alternative():
    return os.path.exists('/proc/version') and 'microsoft' in open('/proc/version').read().lower()
```

## 모범 사례

### 1. 경로 처리
- 항상 `os.path.join()` 사용
- 하드코딩된 경로는 주석으로 보존
- 환경변수 우선, 자동 감지 fallback

### 2. 오류 처리
- 경로 접근 전 존재 여부 확인
- try-except 블록으로 안전한 환경 감지
- 의미 있는 오류 메시지 제공

### 3. 로깅
- 환경 감지 결과 로그 출력
- 사용 중인 경로 정보 출력
- 디버깅을 위한 상세 정보 제공

## 결론

이 메뉴얼을 따라 모든 파일을 수정하면, LawPass 시스템이 Windows와 WSL 환경에서 모두 원활하게 작동할 것입니다. 수정 작업은 우선순위가 높은 파일부터 시작하여 순차적으로 진행하고, 각 파일 수정 후 반드시 테스트를 수행하여 정상 작동을 확인해야 합니다.

---
*문서 생성일: 2025-07-04*
*최종 수정일: 2025-07-04*
*작성자: Claude Code*